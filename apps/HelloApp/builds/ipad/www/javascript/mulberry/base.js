dojo.provide("mulberry.base");dojo._hasResource["mulberry.app.Config"]||(dojo._hasResource["mulberry.app.Config"]=!0,dojo.provide("mulberry.app.Config"),function(){var a={};mulberry.app.Config={get:function(b){return a[b]},set:function(b,c){a=a||{};a[b]=c},registerConfig:function(b){a=b||{}}};mulberry._Config&&mulberry.app.Config.registerConfig(mulberry._Config)}(dojo));
dojo._hasResource["mulberry.Device"]||(dojo._hasResource["mulberry.Device"]=!0,dojo.provide("mulberry.Device"),mulberry._loadDeviceConfig=function(){var a=mulberry,b;if(!(b=mulberry.app.Config.get("device")))b=dojo.body(),b={type:640<Math.min(b.offsetWidth,b.offsetHeight)?"tablet":"phone",os:"browser"};a.Device=b},mulberry._loadDeviceConfig());
dojo._hasResource["mulberry._Logging"]||(dojo._hasResource["mulberry._Logging"]=!0,dojo.provide("mulberry._Logging"),function(a,b,c){function d(a){var b="";e&&(b=" ("+(a-e)+"ms since last log) ");e=a;return b}var e,g=(new Date).getTime();a.mixin(mulberry,{log:function(){var a=[].slice.call(arguments),d=(new Date).getTime();console.log(d-g);b.device?console.log("\n\n "+a.join(" ")+"\n\n"):c.log.apply(c,a);g=d},logSection:function(a){var c=(new Date).getTime();console.log((b.device?"\n":"")+"=====\n"+
c+"   START "+a+d(c)+"\n=====")},endLogSection:function(a){var c=(new Date).getTime();console.log((b.device?"\n":"")+"=====\n"+c+"   END   "+a+d(c)+"\n=====")}})}(dojo,window,console));
dojo._hasResource["mulberry._PageDef"]||(dojo._hasResource["mulberry._PageDef"]=!0,dojo.provide("mulberry._PageDef"),mulberry.pageDefs=mulberry.pageDefs||{},dojo.declare("mulberry._PageDef",null,{constructor:function(a){if(!a.screens||!a.screens.length)throw"Page definition must include at least one screen";dojo.forEach(a.screens,function(a){if(!a.regions||!a.regions.length)throw"Page definition must include at least one region per screen";});dojo.mixin(this,a)}}),mulberry.pageDef=function(a,b){mulberry.pageDefs[a]=
new mulberry._PageDef(b)});
dojo._hasResource["dojo.store.util.QueryResults"]||(dojo._hasResource["dojo.store.util.QueryResults"]=!0,dojo.provide("dojo.store.util.QueryResults"),dojo.getObject("store.util",!0,dojo),dojo.store.util.QueryResults=function(a){function b(b){a[b]||(a[b]=function(){var d=arguments;return dojo.when(a,function(a){Array.prototype.unshift.call(d,a);return dojo.store.util.QueryResults(dojo[b].apply(dojo,d))})})}if(!a)return a;a.then&&(a=dojo.delegate(a));b("forEach");b("filter");b("map");a.total||(a.total=
dojo.when(a,function(a){return a.length}));return a});
dojo._hasResource["dojo.store.util.SimpleQueryEngine"]||(dojo._hasResource["dojo.store.util.SimpleQueryEngine"]=!0,dojo.provide("dojo.store.util.SimpleQueryEngine"),dojo.getObject("store.util",!0,dojo),dojo.store.util.SimpleQueryEngine=function(a,b){function c(c){c=dojo.filter(c,a);b&&b.sort&&c.sort(function(a,c){for(var d,e=0;d=b.sort[e];e++){var g=a[d.attribute],n=c[d.attribute];if(g!=n)return!!d.descending==g>n?-1:1}return 0});if(b&&(b.start||b.count)){var d=c.length,c=c.slice(b.start||0,(b.start||
0)+(b.count||Infinity));c.total=d}return c}switch(typeof a){default:throw Error("Can not query with a "+typeof a);case "object":case "undefined":var d=a,a=function(a){for(var b in d){var c=d[b];if(c&&c.test){if(!c.test(a[b]))return!1}else if(c!=a[b])return!1}return!0};break;case "string":if(!this[a])throw Error("No filter function "+a+" was found in store");a=this[a];case "function":}c.matches=a;return c});
dojo._hasResource["dojo.store.Memory"]||(dojo._hasResource["dojo.store.Memory"]=!0,dojo.provide("dojo.store.Memory"),dojo.declare("dojo.store.Memory",null,{constructor:function(a){this.index={};dojo.mixin(this,a);this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:dojo.store.util.SimpleQueryEngine,get:function(a){return this.index[a]},getIdentity:function(a){return a[this.idProperty]},put:function(a,b){var c=b&&b.id||a[this.idProperty]||Math.random();this.index[c]=a;for(var d=
this.data,e=this.idProperty,g=0,h=d.length;g<h;g++)if(d[g][e]==c)return d[g]=a,c;this.data.push(a);return c},add:function(a,b){if(this.index[b&&b.id||a[this.idProperty]])throw Error("Object already exists");return this.put(a,b)},remove:function(a){delete this.index[a];for(var b=this.data,c=this.idProperty,d=0,e=b.length;d<e;d++)if(b[d][c]==a){b.splice(d,1);break}},query:function(a,b){return dojo.store.util.QueryResults(this.queryEngine(a,b)(this.data))},setData:function(a){a.items?(this.idProperty=
a.identifier,a=this.data=a.items):this.data=a;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.index[d[this.idProperty]]=d}}}));
dojo._hasResource["mulberry._Store"]||(dojo._hasResource["mulberry._Store"]=!0,dojo.provide("mulberry._Store"),dojo.declare("mulberry._Store",dojo.store.Memory,{add:function(a){a=this._createModel(a);this.put(a)},get:function(a){return this._createModel(this.inherited(arguments))},put:function(a){this.inherited(arguments);this._save()},remove:function(a){this.inherited(arguments);this._save()},query:function(a,b){return(a?this.inherited(arguments):dojo.store.util.QueryResults(this.data)).map(dojo.hitch(this,
"_createModel"))},setData:function(a){this.inherited(arguments);this._save()},prepareData:function(a){return a},process:function(a){a=this.prepareData(a);this.model&&client.models[this.model]&&(a=this._createModels(a));return a},invoke:function(a,b){var a=dojo.isArray(a)?a:[a],c=dojo.map(a,function(a){a=this.get(a);dojo.hitch(a,b)(a);this.put(a);return a},this);return dojo.store.util.QueryResults(c)},_createModel:function(a){this.model&&client.models[this.model]?(a=new client.models[this.model](a),
a.format()):console.warn("No model for "+this.declaredClass);a.id||(a.id=this._createId());return a},_createModels:function(a){return dojo.map(a,dojo.hitch(this,"_createModel"))},_save:function(){mulberry.app.DeviceStorage.set(this.key,this.data)},_createId:function(){return(65536*(1+Math.random())).toString(16).substring(1)}}),mulberry.store=function(a,b){dojo.declare("client.stores."+a,mulberry._Store,dojo.mixin({key:a,data:mulberry.app.DeviceStorage.get(a)},b));client.stores[a]=new client.stores[a]});
dojo._hasResource["mulberry._Model"]||(dojo._hasResource["mulberry._Model"]=!0,dojo.provide("mulberry._Model"),dojo.declare("mulberry._Model",dojo.Stateful,{format:function(){}}),mulberry.model=function(a,b){dojo.declare("client.models."+a,mulberry._Model,b)});
dojo._hasResource["mulberry._Capability"]||(dojo._hasResource["mulberry._Capability"]=!0,dojo.provide("mulberry._Capability"),dojo.declare("mulberry._Capability",null,{requirements:{},connects:[],constructor:function(a){dojo.mixin(this,a);this.domNode=this.page.domNode;this.node=this.page.node;this.involved=this._loadInvolvedComponents();if(!this._checkRequirements())throw console.error("Did not find required components for capability",this.declaredClass),console.error("These are the components I know about",
this.involved),"Did not find required components for capability "+this.declaredClass;this._doLookups();this._doConnects();this.init()},init:function(){},_loadInvolvedComponents:function(){var a={};dojo.forEach(this.components||[],function(b){var c=b.split(":"),b=c[0],c=c[1],d=this.page.getScreen(b).getComponent(c);d||console.error("Capability",this.declaredClass,"did not find component for",c,"on the",b,"screen");a[c]=d},this);return a},_checkRequirements:function(){var a=!0;dojo.forIn(this.requirements,
function(b,c){var d=!!this.involved[c]||this.page.getComponent(c);a=a&&d;d||console.warn("did not find",c)},this);return a},_doLookups:function(){dojo.forIn(this.requirements,function(a,b){this[a]=this.involved[b]||this.page.getComponent(b)},this)},_doConnects:function(){dojo.forEach(this.connects,function(a){this.connect.apply(this,a)},this)},connect:function(a,b,c){dojo.isString(a)&&(a=this[a]);this.page.connect(a,b,dojo.hitch(this,c))}}),mulberry.capability=function(a,b){dojo.declare("mulberry.capabilities."+
a,mulberry._Capability,b)});
dojo._hasResource["mulberry.Utilities"]||(dojo._hasResource["mulberry.Utilities"]=!0,dojo.provide("mulberry.Utilities"),dojo.forIn=function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&dojo.hitch(c||window,b)(d,a[d])},mulberry.util={truncate:function(a,b){var c,b=b||200,a=a.replace("</p>"," ").replace("<br>"," ").replace(/(<\/.>)|(<.>)|(<[^b][^r]?[^>]*>)/g,"");c=a=dojo.trim(a);(a=a.substr(0,b))&&c.length>b&&(a+=" &hellip;");return a},copyStyles:function(a,b,c){var d=window.getComputedStyle(a);dojo.forEach(c,
function(a){dojo.style(b,a,d[a])})}},mulberry.tmpl=function(a,b){return dojo.string.substitute(a,b)},mulberry.haml=Haml,mulberry.jsonp=function(a,b){b=dojo.isObject(a)?a:b||{};b.callbackParamName=b.callback||b.callbackParamName||"callback";a=dojo.isString(a)?a:b.url;return!a?void 0:dojo.io.script.get(dojo.delegate(b,{url:a}))},mulberry.page=function(a,b,c){mulberry.route(a,function(a){mulberry.showPage(mulberry.createPage(dojo.mixin(b,{params:a})))},c)});
dojo._hasResource["mulberry.app.URL"]||(dojo._hasResource["mulberry.app.URL"]=!0,dojo.provide("mulberry.app.URL"),mulberry.app.URL={protocol:function(){return/^https/.test(document.location.protocol)?"https":"http"},tel:function(a){return"tel:"+a.replace(/\W/g,"")},googleMapAddress:function(a){return"http://maps.google.com/maps?"+dojo.objectToQuery({q:a})}});
dojo._hasResource["mulberry.app.PhoneGap.notification"]||(dojo._hasResource["mulberry.app.PhoneGap.notification"]=!0,dojo.provide("mulberry.app.PhoneGap.notification"),mulberry.app.PhoneGap.notification=function(a){return{alert:function(b){a?navigator.notification.alert(b):alert(b)}}});
dojo._hasResource["mulberry.app.PhoneGap.device"]||(dojo._hasResource["mulberry.app.PhoneGap.device"]=!0,dojo.provide("mulberry.app.PhoneGap.device"),function(){function a(a){if(!a||!dojo.isString(a)||!dojo.trim(a))return"unknown";return a.match("Android")?(a=dojo.trim(a.split("Android")[1].split(";")[0]).split("-")[0].split("."),b(a)):-1<a.indexOf("AppleWebKit")&&0<=a.indexOf("iPhone")+a.indexOf("iPad")+a.indexOf("iPod")?"unknown-ios-webkit":"unknown"}function b(a){return[a[0],a[1]||"0"].join("-")}
mulberry.app.PhoneGap.device=function(c){return{version:c?b(window.device.version.split("-")[0].split(".")):a(window.navigator.userAgent),_parseVersion:a}}}());
dojo._hasResource["mulberry.app.PhoneGap.network"]||(dojo._hasResource["mulberry.app.PhoneGap.network"]=!0,dojo.provide("mulberry.app.PhoneGap.network"),mulberry.app.PhoneGap.network=function(){var a,b,c;return{isReachable:function(){console.log("mulberry.app.PhoneGap.network::isReachable()");var d=new dojo.Deferred,e=(new Date).getTime();if(b&&!c&&3E5>e-b)return d.resolve(c),d;b=e;navigator.network&&navigator.network.connection?(a=navigator.network.connection.type,c=a===Connection.UNKNOWN||a===Connection.NONE?
!1:!0):c=!0;d.resolve(c);return d.promise},state:function(){var a={},b;return navigator.network&&navigator.network.connection?(a[Connection.UNKNOWN]="Unknown connection",a[Connection.ETHERNET]="Ethernet connection",a[Connection.WIFI]="WiFi connection",a[Connection.CELL_2G]="Cell 2G connection",a[Connection.CELL_3G]="Cell 3G connection",a[Connection.CELL_4G]="Cell 4G connection",a[Connection.NONE]="No network connection",b=navigator.network.connection.type,{state:b,description:a[b]}):{state:-1,description:"Unknown connection"}}}});
dojo._hasResource["mulberry.app.PhoneGap.audio"]||(dojo._hasResource["mulberry.app.PhoneGap.audio"]=!0,dojo.provide("mulberry.app.PhoneGap.audio"),mulberry.app.PhoneGap.audio=function(a){var b,c=function(){},d=function(){};return{play:function(e){console.log("mulberry.app.PhoneGap.audio::play()");a&&(e=/^http/.test(e)?e:"/android_asset/www/"+e,b=new Media(e,c,d),b.play())},stop:function(){console.log("mulberry.app.PhoneGap.audio::stop()");a&&b&&b.pause()},destroy:function(){b&&(b.stop(),b.release(),
b=null)}}});
dojo._hasResource["vendor.urbanairship.push"]||(dojo._hasResource["vendor.urbanairship.push"]=!0,dojo.provide("vendor.urbanairship.push"),vendor.urbanairship.push=function(){var a=function(){};a.prototype.register=function(a,c,d){PhoneGap.exec(a,c,"PushNotification","registerAPN",d)};a.prototype.startNotify=function(){PhoneGap.exec(null,null,"PushNotification","startNotify",[])};a.prototype.log=function(a){PhoneGap.exec(null,null,"PushNotification","log",[{msg:a}])};PhoneGap.addConstructor(function(){window.plugins||(window.plugins=
{});window.plugins.pushNotification=new a})});dojo._hasResource["mulberry.app.PhoneGap.push"]||(dojo._hasResource["mulberry.app.PhoneGap.push"]=!0,dojo.provide("mulberry.app.PhoneGap.push"),mulberry.app.PhoneGap.push=function(a){a&&vendor.urbanairship.push()});
dojo._hasResource["mulberry.app.PhoneGap.browser"]||(dojo._hasResource["mulberry.app.PhoneGap.browser"]=!0,dojo.provide("mulberry.app.PhoneGap.browser"),mulberry.app.PhoneGap.browser=function(a,b){function c(){}window.ChildBrowser=c;var d=b.os,e={ios:function(){c._onLocationChange=function(a){window.plugins.childBrowser.onLocationChange(a)};c._onClose=function(){window.plugins.childBrowser.onClose()};c._onOpenExternal=function(){window.plugins.childBrowser.onOpenExternal()};c._onJSCallback=function(){};
c.prototype.showWebPage=function(a){PhoneGap.exec("ChildBrowserCommand.showWebPage",a)};c.prototype.close=function(){PhoneGap.exec("ChildBrowserCommand.close")};c.prototype.jsExec=function(){};c.install=function(){window.plugins||(window.plugins={});window.plugins.childBrowser=new c;return window.plugins.childBrowser};c.install()},android:function(){c.prototype.showWebPage=function(a,b){PhoneGap.exec(null,null,"ChildBrowser","showWebPage",[a,b])};PhoneGap.addConstructor(function(){PhoneGap.addPlugin("childBrowser",
new c);PluginManager.addService("ChildBrowser","com.phonegap.plugins.childBrowser.ChildBrowser")})}};if(a&&e[d])e[d]();return{url:function(b){a?"android"===d?PhoneGap.exec(null,null,"ChildBrowser","showWebPage",[b,!1]):window.plugins.childBrowser.showWebPage(b):window.location=b},getBrowser:function(){if(!window.plugins.childBrowser)throw Error("Can't find childBrowser plugin");return window.plugins.childBrowser}}});
dojo._hasResource["mulberry.app.PhoneGap.camera"]||(dojo._hasResource["mulberry.app.PhoneGap.camera"]=!0,dojo.provide("mulberry.app.PhoneGap.camera"),mulberry.app.PhoneGap.camera=function(a){var b=function(){};return{getPicture:function(c,d,e){dojo.isFunction(c)||(e=c,d=c=!1);var g=new dojo.Deferred;a&&navigator&&navigator.camera?navigator.camera.getPicture(function(a){(c||b)(a);g.resolve(a)},function(a){(d||b)(a);g.reject(a)},e):g.resolve();return g.promise}}});
dojo._hasResource["mulberry.app.PhoneGap.geolocation"]||(dojo._hasResource["mulberry.app.PhoneGap.geolocation"]=!0,dojo.provide("mulberry.app.PhoneGap.geolocation"),mulberry.app.PhoneGap.geolocation=function(){var a=function(){};return{getCurrentPosition:function(b,c,d){dojo.isFunction(b)||(d=b,c=b=!1);var e=new dojo.Deferred,g=function(b){(c||a)(b);e.reject(b)};navigator.geolocation&&navigator.geolocation.getCurrentPosition?navigator.geolocation.getCurrentPosition(function(c){(b||a)(c);e.resolve(c)},
g,d):g("Geolocation API not available");return e.promise},watchPosition:function(a,c,d){return navigator.geolocation&&navigator.geolocation.watchPosition?navigator.geolocation.watchPosition(a,c,d):!1},clearWatch:function(a){a&&navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(a)}}});
dojo._hasResource["mulberry.app.PhoneGap.accelerometer"]||(dojo._hasResource["mulberry.app.PhoneGap.accelerometer"]=!0,dojo.provide("mulberry.app.PhoneGap.accelerometer"),mulberry.app.PhoneGap.accelerometer=function(){var a=function(){};return{getCurrentAcceleration:function(b,c){var d=new dojo.Deferred,e=function(b){(c||a)(b);d.reject(b)};navigator.accelerometer&&navigator.accelerometer.getCurrentAcceleration?navigator.accelerometer.getCurrentAcceleration(function(c){(b||a)(c);d.resolve(c)},e):e("Accelerometer API not available");
return d.promise},watchAcceleration:function(a,c){return navigator.accelerometer&&navigator.accelerometer.watchAcceleration?navigator.accelerometer.watchAcceleration(a,c):!1},clearWatch:function(a){a=a.watchId||a;navigator.accelerometer&&navigator.accelerometer.clearWatch&&a&&navigator.accelerometer.clearWatch(a)}}});
dojo._hasResource["mulberry.app.PhoneGap"]||(dojo._hasResource["mulberry.app.PhoneGap"]=!0,dojo.provide("mulberry.app.PhoneGap"),function(){mulberry.app.PhoneGap.registerAPI=function(a,b){var c=dojo.subscribe("/app/deviceready",function(){var d=mulberry.Device,e=mulberry.app.PhoneGap.present=window.device&&window.device.phonegap;mulberry.app.PhoneGap[a]=b(e,d);dojo.unsubscribe(c)})};dojo.forEach("notification,device,network,audio,push,browser,camera,geolocation,accelerometer".split(","),function(a){mulberry.app.PhoneGap.registerAPI(a,
mulberry.app.PhoneGap[a])})}());
dojo._hasResource["mulberry.app.DeviceStorage"]||(dojo._hasResource["mulberry.app.DeviceStorage"]=!0,dojo.provide("mulberry.app.DeviceStorage"),mulberry.app.DeviceStorage=function(){var a={tour:{tableName:"items",fields:["id text","json text"],insertStatement:function(a,c){return["INSERT INTO "+a+"( id, json ) VALUES ( ?, ? )",[c.id,JSON.stringify(c)]]},processSelecton:function(a){var c=[],d=a.rows.length,e,g;for(g=0;g<d;g++)e=a.rows.item(g).json,c.push(e?JSON.parse(e):{});return c}}};return{init:function(a){this.appId=
a;if("openDatabase"in window){var c=this._db=openDatabase(a+"-"+mulberry.version,"1.0",a+" Database",5242880);c||console.log("No database. This will end badly.");this._sql=function(a,b){var g=new dojo.Deferred,h,a=dojo.isArray(a)?a:[a];h=a.length;c.transaction(function(c){dojo.forEach(a,function(a,d){var i,n,p=[];d+1===h?(i=dojo.isFunction(b)?function(a,c){g.callback(b(c))}:g.callback,n=g.errback):i=n=function(){};dojo.isArray(a)&&(p=a[1],a=a[0]);c.executeSql(a,p,i,n)})});return g}}else this._sql=
function(){var a=new dojo.Deferred;a.resolve();return a.promise};return this._db},drop:function(){var b=[];dojo.forIn(a,function(a,d){b.push("DROP TABLE IF EXISTS "+d.tableName)});window.localStorage.clear();return this._sql&&this._sql(b)},set:function(b,c){var d=a[b],e;if(d)return e=["DROP TABLE IF EXISTS "+d.tableName,"CREATE TABLE "+d.tableName+"("+d.fields.join(",")+")"],dojo.forEach(c,function(a){e.push(d.insertStatement(d.tableName,a))}),this._sql(e);window.localStorage.setItem(b,JSON.stringify(c));
return!0},get:function(b){var c=a[b];if(c)return this._sql("SELECT * FROM "+c.tableName,c.processSelecton);b=window.localStorage.getItem(b);"undefined"===b&&(b=null);return b=b&&JSON.parse(b)}}}());
dojo._hasResource["mulberry._Nls"]||(dojo._hasResource["mulberry._Nls"]=!0,dojo.provide("mulberry._Nls"),dojo.declare("mulberry._Nls",null,{data:{__initialized:!1},constructor:function(){this.data.__initialized||(this.data.nlsStrings=dojo.i18n.getLocalization("mulberry","mulberry",mulberry.app.Config.get("locale")),this.data.__initialized=!0)},getString:function(a,b){var c=this.data.nlsStrings[a];return b?dojo.string.substitute(c,b):c},postMixInProperties:function(){this.inherited("postMixInProperties",
arguments);this.initializeStrings()},initializeStrings:function(){}}));
dojo._hasResource["vendor.iscroll"]||(dojo._hasResource["vendor.iscroll"]=!0,dojo.provide("vendor.iscroll"),function(){function a(a,t){var j=this,i=document,o;j.wrapper="object"==typeof a?a:i.getElementById(a);j.wrapper.style.overflow="hidden";j.scroller=j.wrapper.children[0];j.options={HWTransition:!0,HWCompositing:!0,hScroll:!0,vScroll:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:h,fadeScrollbar:g&&b||!c,hideScrollbar:g||!c,scrollbarClass:"",bounce:b,bounceLock:!1,momentum:b,lockDirection:!0,zoom:!1,
zoomMin:1,zoomMax:4,snap:!1,pullToRefresh:!1,pullDownLabel:["Pull down to refresh...","Release to refresh...","Loading..."],pullUpLabel:["Pull up to refresh...","Release to refresh...","Loading..."],onPullDown:function(){},onPullUp:function(){},onScrollStart:null,onScrollEnd:null,onZoomStart:null,onZoomEnd:null,checkDOMChange:!1};for(o in t)j.options[o]=t[o];j.options.HWCompositing=j.options.HWCompositing&&e;j.options.HWTransition=j.options.HWTransition&&e;j.scroller.style.cssText=j.options.HWCompositing?
j.scroller.style.cssText+("-webkit-transition-property:-webkit-transform;-webkit-transform-origin:0 0;-webkit-transform:"+p+"0,0"+s):j.scroller.style.cssText+"-webkit-transition-property:top,left;-webkit-transform-origin:0 0;top:0;left:0";j.options.HWTransition&&(j.scroller.style.cssText+="-webkit-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-webkit-transition-duration:0;");j.options.hScrollbar=j.options.hScroll&&j.options.hScrollbar;j.options.vScrollbar=j.options.vScroll&&j.options.vScrollbar;
j.pullDownToRefresh="down"==j.options.pullToRefresh||"both"==j.options.pullToRefresh;j.pullUpToRefresh="up"==j.options.pullToRefresh||"both"==j.options.pullToRefresh;j.pullDownToRefresh&&(o=i.createElement("div"),o.className="iScrollPullDown",o.innerHTML='<span class="iScrollPullDownIcon"></span><span class="iScrollPullDownLabel">'+j.options.pullDownLabel[0]+"</span>\n",j.scroller.insertBefore(o,j.scroller.children[0]),j.options.bounce=!0,j.pullDownEl=o,j.pullDownLabel=o.getElementsByTagName("span")[1]);
j.pullUpToRefresh&&(o=i.createElement("div"),o.className="iScrollPullUp",o.innerHTML='<span class="iScrollPullUpIcon"></span><span class="iScrollPullUpLabel">'+j.options.pullUpLabel[0]+"</span>\n",j.scroller.appendChild(o),j.options.bounce=!0,j.pullUpEl=o,j.pullUpLabel=o.getElementsByTagName("span")[1]);j.refresh();j._bind(k,window);j._bind(f);d&&j.options.zoom&&(j._bind("gesturestart"),j.scroller.style.webkitTransform+=" scale(1)");c||j._bind("mousewheel");j.options.checkDOMChange&&(j.DOMChangeInterval=
setInterval(function(){j._checkSize()},250))}a.prototype={x:0,y:0,currPageX:0,currPageY:0,pagesX:[],pagesY:[],offsetBottom:0,offsetTop:0,scale:1,lastScale:1,contentReady:!0,handleEvent:function(a){switch(a.type){case f:this._start(a);break;case l:this._move(a);break;case i:case n:this._end(a);break;case "webkitTransitionEnd":this._transitionEnd(a);break;case k:this._resize();break;case "gesturestart":this._gestStart(a);break;case "gesturechange":this._gestChange(a);break;case "gestureend":case "gesturecancel":this._gestEnd(a);
break;case "mousewheel":this._wheel(a)}},_scrollbar:function(a){var b=document,c;this[a+"Scrollbar"]?(this[a+"ScrollbarWrapper"]||(c=b.createElement("div"),this.options.scrollbarClass?c.className=this.options.scrollbarClass+a.toUpperCase():c.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:7px":"width:7px;bottom:7px;top:2px;right:1px"),c.style.cssText+="pointer-events:none;-webkit-transition-property:opacity;-webkit-transition-duration:"+(this.options.fadeScrollbar?
"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(c),this[a+"ScrollbarWrapper"]=c,c=b.createElement("div"),this.options.scrollbarClass||(c.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-webkit-background-clip:padding-box;-webkit-box-sizing:border-box;"+("h"==a?"height:100%;-webkit-border-radius:4px 3px;":"width:100%;-webkit-border-radius:3px 4px;")),c.style.cssText+="pointer-events:none;-webkit-transition-property:-webkit-transform;-webkit-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-webkit-transition-duration:0;-webkit-transform:"+
p+"0,0"+s,this[a+"ScrollbarWrapper"].appendChild(c),this[a+"ScrollbarIndicator"]=c),"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=m.max(m.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,
this.vScrollbarIndicatorSize=m.max(m.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._indicatorPos(a,!0)):this[a+"ScrollbarWrapper"]&&(this[a+"ScrollbarIndicator"].style.webkitTransform="",this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+
"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},0)},_checkSize:function(){var a,b;!this.moved&&!this.zoomed&&this.contentReady&&(a=m.round(this.scroller.offsetWidth*this.scale),b=m.round((this.scroller.offsetHeight-this.offsetBottom-this.offsetTop)*this.scale),a==this.scrollerW&&b==this.scrollerH||this.refresh())},_pos:function(a,b){this.x=this.hScroll?a:0;this.y=this.vScroll?b:0;this.scroller.style.webkitTransform=p+this.x+
"px,"+this.y+"px"+s+" scale("+this.scale+")";this._indicatorPos("h");this._indicatorPos("v")},_indicatorPos:function(a,b){var c="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(c*=this[a+"ScrollbarProp"],0>c?(c=this.options.fixedScrollbar?0:c+3*c,9>this[a+"ScrollbarIndicatorSize"]+c&&(c=-this[a+"ScrollbarIndicatorSize"]+8)):c>this[a+"ScrollbarMaxScroll"]&&(c=this.options.fixedScrollbar?this[a+"ScrollbarMaxScroll"]:c+3*(c-this[a+"ScrollbarMaxScroll"]),9>this[a+"ScrollbarIndicatorSize"]+this[a+"ScrollbarMaxScroll"]-
c&&(c=this[a+"ScrollbarIndicatorSize"]+this[a+"ScrollbarMaxScroll"]-8)),this[a+"ScrollbarWrapper"].style.webkitTransitionDelay="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?"0":"1",this[a+"ScrollbarIndicator"].style.webkitTransform=p+("h"==a?c+"px,0":"0,"+c+"px")+s)},_transitionTime:function(a){a+="ms";this.scroller.style.webkitTransitionDuration=a;this.hScrollbar&&(this.hScrollbarIndicator.style.webkitTransitionDuration=a);this.vScrollbar&&(this.vScrollbarIndicator.style.webkitTransitionDuration=
a)},_start:function(a){var b=c?a.changedTouches[0]:a,j;this.moved=!1;if({SELECT:1,INPUT:1,BUTTON:1,TEXTAREA:1}[a.target.tagName])return!0;a.preventDefault();c&&2==a.touches.length&&this.options.zoom&&d&&!this.zoomed&&(this.originX=m.abs(a.touches[0].pageX+a.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=m.abs(a.touches[0].pageY+a.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y);this.moved=!1;this.returnTime=this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=
0;this._transitionTime(0);if(this.options.momentum)if(this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null),this.options.HWCompositing){if(j=new WebKitCSSMatrix(window.getComputedStyle(this.scroller,null).webkitTransform),j.m41!=this.x||j.m42!=this.y)this._unbind("webkitTransitionEnd"),this._pos(j.m41,j.m42)}else if(j=window.getComputedStyle(this.scroller,null),this.x+"px"!=j.left||this.y+"px"!=j.top)this._unbind("webkitTransitionEnd"),this._pos(1*j.left.replace(/[^0-9]/g),
1*j.top.replace(/[^0-9]/g));this.scroller.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)";this.hScrollbar&&(this.hScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)");this.vScrollbar&&(this.vScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)");this.startX=this.x;this.startY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this.startTime=a.timeStamp;this.options.onScrollStart&&this.options.onScrollStart.call(this);
this._bind(l);this._bind(i);this._bind(n)},_move:function(a){if(!(c&&1<a.touches.length)){var b=c?a.changedTouches[0]:a,d=b.pageX-this.pointX,e=b.pageY-this.pointY,g=this.x+d,f=this.y+e;a.preventDefault();this.pointX=b.pageX;this.pointY=b.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?this.x+d/2.4:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(0<f||f<this.maxScrollY)f=this.options.bounce?this.y+e/2.4:0<=f||0<=this.maxScrollY?0:this.maxScrollY,this.options.pullToRefresh&&this.contentReady&&(this.pullDownToRefresh&&
f>this.offsetBottom?(this.pullDownEl.className="iScrollPullDown flip",this.pullDownLabel.innerText=this.options.pullDownLabel[1]):this.pullDownToRefresh&&this.pullDownEl.className.match("flip")&&(this.pullDownEl.className="iScrollPullDown",this.pullDownLabel.innerText=this.options.pullDownLabel[0]),this.pullUpToRefresh&&f<this.maxScrollY-this.offsetTop?(this.pullUpEl.className="iScrollPullUp flip",this.pullUpLabel.innerText=this.options.pullUpLabel[1]):this.pullUpToRefresh&&this.pullUpEl.className.match("flip")&&
(this.pullUpEl.className="iScrollPullUp",this.pullUpLabel.innerText=this.options.pullUpLabel[0]));4>this.absDistX&&4>this.absDistY?(this.distX+=d,this.distY+=e,this.absDistX=m.abs(this.distX),this.absDistY=m.abs(this.distY)):(this.options.lockDirection&&(this.absDistX>this.absDistY+3?(f=this.y,e=0):this.absDistY>this.absDistX+3&&(g=this.x,d=0)),this.moved=!0,this._pos(g,f),this.dirX=0<d?-1:0>d?1:0,this.dirY=0<e?-1:0>e?1:0,300<a.timeStamp-this.startTime&&(this.startTime=a.timeStamp,this.startX=this.x,
this.startY=this.y))}},_end:function(a){if(!(c&&0!=a.touches.length)){var b=this,d=c?a.changedTouches[0]:a,e,g,f={dist:0,time:0},q={dist:0,time:0},h=a.timeStamp-b.startTime,k=b.x,y=b.y;b._unbind(l);b._unbind(i);b._unbind(n);if(!b.zoomed)if(b.moved){b.pullDownToRefresh&&b.contentReady&&b.pullDownEl.className.match("flip")&&(b.pullDownEl.className="iScrollPullDown loading",b.pullDownLabel.innerText=b.options.pullDownLabel[2],b.scroller.style.marginTop="0",b.offsetBottom=0,b.refresh(),b.contentReady=
!1,b.options.onPullDown());b.pullUpToRefresh&&b.contentReady&&b.pullUpEl.className.match("flip")&&(b.pullUpEl.className="iScrollPullUp loading",b.pullUpLabel.innerText=b.options.pullUpLabel[2],b.scroller.style.marginBottom="0",b.offsetTop=0,b.refresh(),b.contentReady=!1,b.options.onPullUp());if(300>h&&b.options.momentum){f=k?b._momentum(k-b.startX,h,-b.x,b.scrollerW-b.wrapperW+b.x,b.options.bounce?b.wrapperW:0):f;q=y?b._momentum(y-b.startY,h,-b.y,0>b.maxScrollY?b.scrollerH-b.wrapperH+b.y:0,b.options.bounce?
b.wrapperH:0):q;k=b.x+f.dist;y=b.y+q.dist;if(0<b.x&&0<k||b.x<b.maxScrollX&&k<b.maxScrollX)f={dist:0,time:0};if(0<b.y&&0<y||b.y<b.maxScrollY&&y<b.maxScrollY)q={dist:0,time:0}}f.dist||q.dist?(f=m.max(m.max(f.time,q.time),10),b.options.snap&&(q=b._snap(k,y),k=q.x,y=q.y,f=m.max(q.time,f)),b.scrollTo(k,y,f)):b.options.snap?(q=b._snap(b.x,b.y),(q.x!=b.x||q.y!=b.y)&&b.scrollTo(q.x,q.y,q.time)):b._resetPos()}else c&&(b.doubleTapTimer&&b.options.zoom?(clearTimeout(b.doubleTapTimer),b.doubleTapTimer=null,b.zoom(b.pointX,
b.pointY,1==b.scale?2:1)):b.doubleTapTimer=setTimeout(function(){b.doubleTapTimer=null;for(e=d.target;1!=e.nodeType;)e=e.parentNode;g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);g._fake=!0;e.dispatchEvent(g)},b.options.zoom?250:0)),b._resetPos()}},_resetPos:function(a){var b=this.x,c=this.y;0<=this.x?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX);0<=this.y||0<this.maxScrollY?c=
0:this.y<this.maxScrollY&&(c=this.maxScrollY);b==this.x&&c==this.y?(this.moved&&(this.options.onScrollEnd&&this.options.onScrollEnd.call(this),this.moved=!1),this.zoomed&&(this.options.onZoomEnd&&this.options.onZoomEnd.call(this),this.zoomed=!1),this.hScrollbar&&this.options.hideScrollbar&&(this.hScrollbarWrapper.style.webkitTransitionDelay="300ms",this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar&&(this.vScrollbarWrapper.style.webkitTransitionDelay="300ms",this.vScrollbarWrapper.style.opacity=
"0")):(void 0===a&&(a=200),a&&(this.scroller.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)",this.hScrollbar&&(this.hScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)"),this.vScrollbar&&(this.vScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)")),this.scrollTo(b,c,a))},_timedScroll:function(a,b,c){var d=this,e=d.x,g=d.y,f=(new Date).getTime(),i;d._transitionTime(0);d.scrollInterval&&(clearInterval(d.scrollInterval),
d.scrollInterval=null);d.scrollInterval=setInterval(function(){var h=(new Date).getTime();h>=f+c?(clearInterval(d.scrollInterval),d.scrollInterval=null,d._pos(a,b),d._transitionEnd()):(h=(h-f)/c-1,i=m.sqrt(1-h*h),h=(a-e)*i+e,d._pos(h,(b-g)*i+g))},20)},_transitionEnd:function(a){a&&a.stopPropagation();this._unbind("webkitTransitionEnd");this._resetPos(this.returnTime);this.returnTime=0},_gestStart:function(){this._transitionTime(0);this.lastScale=1;this.options.onZoomStart&&this.options.onZoomStart.call(this);
this._unbind("gesturestart");this._bind("gesturechange");this._bind("gestureend");this._bind("gesturecancel")},_gestChange:function(a){var a=this.scale*a.scale,b;this.zoomed=!0;a<this.options.zoomMin?a=this.options.zoomMin:a>this.options.zoomMax&&(a=this.options.zoomMax);b=a/this.scale;this.scroller.style.webkitTransform=p+(this.originX-this.originX*b+this.x)+"px,"+(this.originY-this.originY*b+this.y)+"px"+s+" scale("+a+")";this.lastScale=b},_gestEnd:function(){var a=this,b=a.scale,c=a.lastScale;
a.scale=b*c;a.scale<a.options.zoomMin+0.05?a.scale=a.options.zoomMin:a.scale>a.options.zoomMax-0.05&&(a.scale=a.options.zoomMax);c=a.scale/b;a.x=a.originX-a.originX*c+a.x;a.y=a.originY-a.originY*c+a.y;a.scroller.style.webkitTransform=p+a.x+"px,"+a.y+"px"+s+" scale("+a.scale+")";setTimeout(function(){a.refresh()},0);a._bind("gesturestart");a._unbind("gesturechange");a._unbind("gestureend");a._unbind("gesturecancel")},_wheel:function(a){var b=this.x+a.wheelDeltaX/12,a=this.y+a.wheelDeltaY/12;0<b?b=
0:b<this.maxScrollX&&(b=this.maxScrollX);0<a?a=0:a<this.maxScrollY&&(a=this.maxScrollY);this.scrollTo(b,a,0)},_momentum:function(a,b,c,d,e){var b=m.abs(a)/b,g=b*b/0.0012,f=0;0<a&&g>c?(f=e/(6/(6.0E-4*(g/b))),c+=f,this.returnTime=800/e*f+100,b=b*c/g,g=c):0>a&&g>d&&(f=e/(6/(6.0E-4*(g/b))),d+=f,this.returnTime=800/e*f+100,b=b*d/g,g=d);return{dist:g*(0>a?-1:1),time:m.round(b/6.0E-4)}},_offset:function(a,b){var c=-a.offsetLeft,d=-a.offsetTop;if(!b)return{x:c,y:d};for(;a=a.offsetParent;)c-=a.offsetLeft,
d-=a.offsetTop;return{x:c,y:d}},_snap:function(a,b){var c,d,e;e=this.pagesX.length-1;for(c=0,d=this.pagesX.length;c<d;c++)if(a>=this.pagesX[c]){e=c;break}e==this.currPageX&&0<e&&0>this.dirX&&e--;a=this.pagesX[e];d=(d=m.abs(a-this.pagesX[this.currPageX]))?500*(m.abs(this.x-a)/d):0;this.currPageX=e;e=this.pagesY.length-1;for(c=0;c<e;c++)if(b>=this.pagesY[c]){e=c;break}e==this.currPageY&&0<e&&0>this.dirY&&e--;b=this.pagesY[e];c=(c=m.abs(b-this.pagesY[this.currPageY]))?500*(m.abs(this.y-b)/c):0;this.currPageY=
e;e=m.round(m.max(d,c))||200;return{x:a,y:b,time:e}},_bind:function(a,b){(b||this.scroller).addEventListener(a,this,!1)},_unbind:function(a,b){(b||this.scroller).removeEventListener(a,this,!1)},destroy:function(){this.options.checkDOMChange&&clearTimeout(this.DOMChangeInterval);this.pullDownToRefresh&&this.pullDownEl.parentNode.removeChild(this.pullDownEl);this.pullUpToRefresh&&this.pullUpEl.parentNode.removeChild(this.pullUpEl);this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");
this.scroller.style.webkitTransform="";this._unbind("webkitTransitionEnd");this._unbind(k);this._unbind(f);this._unbind(l);this._unbind(i);this._unbind(n);this.options.zoom&&(this._unbind("gesturestart"),this._unbind("gesturechange"),this._unbind("gestureend"),this._unbind("gesturecancel"))},refresh:function(){var a=0,b=0,c,d,e;this.pullDownToRefresh&&((c=this.pullDownEl.className.match("loading"))&&!this.contentReady?(e=this.scrollerH,this.contentReady=!0,this.pullDownEl.className="iScrollPullDown",
this.pullDownLabel.innerText=this.options.pullDownLabel[0],this.offsetBottom=this.pullDownEl.offsetHeight,this.scroller.style.marginTop=-this.offsetBottom+"px"):c||(this.offsetBottom=this.pullDownEl.offsetHeight,this.scroller.style.marginTop=-this.offsetBottom+"px"));this.pullUpToRefresh&&((c=this.pullUpEl.className.match("loading"))&&!this.contentReady?(e=this.scrollerH,this.contentReady=!0,this.pullUpEl.className="iScrollPullUp",this.pullUpLabel.innerText=this.options.pullUpLabel[0],this.offsetTop=
this.pullUpEl.offsetHeight,this.scroller.style.marginBottom=-this.offsetTop+"px"):c||(this.offsetTop=this.pullUpEl.offsetHeight,this.scroller.style.marginBottom=-this.offsetTop+"px"));this.wrapperW=this.wrapper.clientWidth;this.wrapperH=this.wrapper.clientHeight;if(!this.wrapperW||!this.wrapperH)return!1;this.scrollerW=m.round(this.scroller.offsetWidth*this.scale);this.scrollerH=m.round((this.scroller.offsetHeight-this.offsetBottom-this.offsetTop)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;
this.maxScrollY=this.wrapperH-this.scrollerH;this.dirY=this.dirX=0;this._transitionTime(0);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;this._scrollbar("h");this._scrollbar("v");if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];d=
this.scroller.querySelectorAll(this.options.snap);for(b=0,c=d.length;b<c;b++)a=this._offset(d[b]),this.pagesX[b]=a.x<this.maxScrollX?this.maxScrollX:a.x*this.scale,this.pagesY[b]=a.y<this.maxScrollY?this.maxScrollY:a.y*this.scale}else if(this.options.snap){for(this.pagesX=[];a>=this.maxScrollX;)this.pagesX[b]=a,a-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=a=0;for(this.pagesY=
[];a>=this.maxScrollY;)this.pagesY[b]=a,a-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this.options.zoom&&(a=this._offset(this.wrapper,!0),this.wrapperOffsetLeft=-a.x,this.wrapperOffsetTop=-a.y);e&&0==this.y&&(e=e-this.scrollerH+this.y,this.scrollTo(0,e,0));this._resetPos()},scrollTo:function(a,b,c,d){var e=this;d&&(a=e.x-a,b=e.y-b);c=!c||m.round(e.x)==m.round(a)&&m.round(e.y)==
m.round(b)?0:c;e.moved=!0;e.options.HWTransition?(c&&e._bind("webkitTransitionEnd"),e._transitionTime(c),e._pos(a,b),c||setTimeout(function(){e._transitionEnd()},0)):e._timedScroll(a,b,c)},scrollToElement:function(a,b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.x=0<c.x?0:c.x<this.maxScrollX?this.maxScrollX:c.x,c.y=0<c.y?0:c.y<this.maxScrollY?this.maxScrollY:c.y,b=void 0===b?m.max(2*m.abs(c.x),2*m.abs(c.y)):b,this.scrollTo(c.x,c.y,b)},scrollToPage:function(a,b,c){this.options.snap?
(a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b]):(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY&&(b=this.maxScrollY));this.scrollTo(a,b,c||400)},zoom:function(a,b,c,d){var e=this,g=c/e.scale,a=a-e.wrapperOffsetLeft-
e.x,b=b-e.wrapperOffsetTop-e.y;e.x=a-a*g+e.x;e.y=b-b*g+e.y;e.scale=c;e.options.onZoomStart&&e.options.onZoomStart.call(e);e.refresh();e._bind("webkitTransitionEnd");e._transitionTime(null!==d?d:200);setTimeout(function(){e.zoomed=!0;e.scroller.style.webkitTransform=p+e.x+"px,"+e.y+"px"+s+" scale("+c+")"},0)}};var b="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,c="ontouchstart"in window,d="ongesturestart"in window,e="WebKitTransitionEvent"in window,g=/iphone|ipad/gi.test(navigator.appVersion),
h=/android/gi.test(navigator.appVersion),k="onorientationchange"in window?"orientationchange":"resize",f=c?"touchstart":"mousedown",l=c?"touchmove":"mousemove",i=c?"touchend":"mouseup",n=c?"touchcancel":"mouseup",p="translate"+(b?"3d(":"("),s=b?",0)":")",m=Math;"undefined"!==typeof exports?exports.iScroll=a:window.iScroll=a}());
dojo._hasResource["mulberry.ui.Scrollable"]||(dojo._hasResource["mulberry.ui.Scrollable"]=!0,dojo.provide("mulberry.ui.Scrollable"),dojo.declare("mulberry.ui.Scrollable",dijit._Widget,{postCreate:function(){this.inherited(arguments);this.subscribe("/page/transition/end","_makeScroller");this.subscribe("/window/resize","refreshScroller");this.subscribe("/fontsize","refreshScroller");this.subscribe("/content/update",function(){this.refreshScroller();this.scroller&&this.scroller.scrollTo(0,0)});dojo.addClass(this.domNode,
"scrollable")},_makeScroller:function(){1<this.domNode.children.length&&console.error("mulberry.ui.Scrollable::_makeScroller: More than one child element. Only the first one will be scrollable. Probably not what you want!");this.scroller=new iScroll(this.domNode,{vScrollbar:!1,onScrollStart:dojo.hitch(this,"onScrollStart"),onScrollEnd:dojo.hitch(this,"onScrollEnd")});this.scroller.refresh()},makeScroller:function(){this.scroller||this._makeScroller()},destroy:function(){this.scroller&&this.scroller.destroy();
this.inherited(arguments)},refreshScroller:function(){this.scroller&&this.scroller.refresh()},onScrollStart:function(){},onScrollEnd:function(){}}));
dojo._hasResource["mulberry.ui.Clickable"]||(dojo._hasResource["mulberry.ui.Clickable"]=!0,dojo.provide("mulberry.ui.Clickable"),dojo.declare("mulberry.ui.Clickable",null,{constructor:function(a,b){this.connections=[];this.secondaryConnections=[];this.subscriptions=[];this.handler=b;this.el=a;this.moved=!1;dojo.addClass(this.el,"not-moving");mulberry.app.UI.hasTouch?(this.connections.push(dojo.connect(a,"touchstart",this,"_onTouchStart")),this.connections.push(dojo.connect(a,"click",function(a){a.preventDefault()}))):
this.connections.push(dojo.connect(a,"click",this,"_handle"))},_onTouchStart:function(){this.touchStartTime=(new Date).getTime();this.secondaryConnections=[dojo.connect(this.el,"touchmove",this,"_onTouchMove"),dojo.connect(this.el,"touchend",this,"_handle")]},_onTouchMove:function(){dojo.removeClass(this.el,"not-moving");this.moved=!0},_handle:function(a){this.touchEndTime=(new Date).getTime();dojo.addClass(this.el,"not-moving");dojo.forEach(this.secondaryConnections||[],dojo.disconnect);this.secondaryConnections=
[];if(mulberry.animating)a.preventDefault(),console.log("click ignored during animation");else{var b=a.target,c=dojo.attr(b,"href");if(this.touchStartTime&&this.touchEndTime-this.touchStartTime>mulberry.app.UI.touchMoveDebounce&&this.moved)this.moved=!1;else{for(;!c&&b!==this.el;)c=dojo.attr(b,"href"),c||(b=b.parentNode);if(c&&(!this.handler||!(dojo.isFunction(this.handler)&&!1===this.handler(b,a)))&&/#/.test(c))if(c=c.split("#")[1])a.preventDefault(),a.stopPropagation(),mulberry.app.Router.go(c)}}},
destroy:function(){dojo.forEach(this.connections||[],dojo.disconnect);dojo.forEach(this.secondaryConnections||[],dojo.disconnect);dojo.forEach(this.subscriptions||[],dojo.unsubscribe)}}));
if(!dojo._hasResource["vendor.mustache"]){dojo._hasResource["vendor.mustache"]=!0;dojo.provide("vendor.mustache");var Mustache="undefined"!==typeof module&&module.exports||{};(function(a){function b(a){return(""+a).replace(/&(?!\w+;)|[<>"']/g,function(a){return o[a]||a})}function c(a,b,c,d){for(var d=d||"<template>",e=b.split("\n"),g=Math.max(c-3,0),f=Math.min(e.length,c+3),e=e.slice(g,f),h=0,i=e.length;h<i;++h)f=h+g+1,e[h]=(f===c?" >> ":"    ")+e[h];a.template=b;a.line=c;a.file=d;a.message=[d+":"+
c,e.join("\n"),"",a.message].join("\n");return a}function d(a,b,c){if("."===a)return b[b.length-1];for(var a=a.split("."),d=a.length-1,e=a[d],g,f,h=b.length,i,j;h;){j=b.slice(0);f=b[--h];for(i=0;i<d;){f=f[a[i++]];if(null==f)break;j.push(f)}if(f&&e in f){g=f[e];break}}"function"===typeof g&&(g=g.call(j[j.length-1]));return null==g&&!c?"":g}function e(a,b,c,e,g){b=d(b,e,!0);if(g)(null==b||!1===b||s(b)&&0===b.length)&&a(c());else if(s(b))m(b,function(b){e.push(b);a(c());e.pop()});else if("object"===
typeof b)e.push(b),a(c()),e.pop();else if("function"===typeof b){var h=e[e.length-1];a(b.call(h,c(),function(a){return f(a,h)})||"")}else b&&a(c())}function g(b,d){for(var d=d||{},e=d.tags||a.tags,g=e[0],f=e[e.length-1],h=["var line = 1;","\ntry {",'\nsend("'],i=[],j=!1,m=!1,k=function(){if(j&&!m&&!d.space)for(;i.length;)h.splice(i.pop(),1);else i=[];m=j=!1},l=[],n,p,o,s=function(a){e=t(a).split(/\s+/);p=e[0];o=e[e.length-1]},w=function(a){h.push('");',n,'\nvar partial = partials["'+t(a)+'"];',"\nif (partial) {",
"\n  send(render(partial, stack[stack.length - 1], partials));","\n}",'\nsend("')},x=function(a,e){var g=t(a);if(""===g)throw c(Error("Section name may not be empty"),b,z,d.file);l.push({name:g,inverted:e});h.push('");',n,'\nvar name = "'+g+'";',"\nvar callback = (function () {","\n  var buffer, send = function (chunk) { buffer.push(chunk); };","\n  return function () {","\n    buffer = [];",'\nsend("')},B=function(a){x(a,!0)},C=function(a){var a=t(a),d=0!=l.length&&l[l.length-1].name;if(!d||a!=d)throw c(Error('Section named "'+
a+'" was never opened'),b,z,file);a=l.pop();h.push('");','\n    return buffer.join("");',"\n  };","\n})();");a.inverted?h.push("\nsendSection(send,name,callback,stack,true);"):h.push("\nsendSection(send,name,callback,stack);");h.push('\nsend("')},D=function(a){h.push('");',n,'\nsend(findName("'+t(a)+'", stack));','\nsend("')},E=function(a){h.push('");',n,'\nsend(escapeHTML(findName("'+t(a)+'", stack)));','\nsend("')},z=1,v,u,r=0,F=b.length;r<F;++r)if(b.slice(r,r+g.length)===g){r+=g.length;v=b.substr(r,
1);n="\nline = "+z+";";p=g;o=f;j=!0;switch(v){case "!":r++;u=null;break;case "=":r++;f="="+f;u=s;break;case ">":r++;u=w;break;case "#":r++;u=x;break;case "^":r++;u=B;break;case "/":r++;u=C;break;case "{":f="}"+f;case "&":r++;m=!0;u=D;break;default:m=!0,u=E}v=b.indexOf(f,r);if(-1===v)throw c(Error('Tag "'+g+'" was not closed properly'),b,z,d.file);g=b.substring(r,v);u&&u(g);for(u=0;~(u=g.indexOf("\n",u));)z++,u++;r=v+f.length-1;g=p;f=o}else switch(v=b.substr(r,1),v){case '"':case "\\":m=!0;h.push("\\"+
v);break;case "\n":i.push(h.length);h.push("\\n");k();z++;break;default:A.test(v)?i.push(h.length):m=!0,h.push(v)}if(0!=l.length)throw c(Error('Section "'+l[l.length-1].name+'" was not closed properly'),b,z,d.file);k();h.push('");',"\nsend(null);","\n} catch (e) { throw {error: e, line: line}; }");f=h.join("").replace(/send\(""\);\n/g,"");d.debug&&("undefined"!=typeof console&&console.log?console.log(f):"function"===typeof print&&print(f));return f}function h(a,h){var i=g(a,h),j=new Function("view,partials,send,stack,findName,escapeHTML,sendSection,render",
i);return function(g,i,m){"function"===typeof i&&(m=i,i={});var i=i||{},k=[],l=[g];try{j(g,i,m||function(a){k.push(a)},l,d,b,e,f)}catch(n){throw c(n.error,a,n.line,h.file);}return k.join("")}}function k(a,b){b=b||{};return!1!==b.cache?(x[a]||(x[a]=h(a,b)),x[a]):h(a,b)}function f(a,b,c,d){return k(a)(b,c,d)}a.name="mustache.js";a.version="0.5.0-dev";a.tags=["{{","}}"];a.parse=g;a.compile=k;a.render=f;a.clearCache=function(){x={}};a.to_html=f;var l=Object.prototype.toString,i=Array.isArray,n=Array.prototype.forEach,
p=String.prototype.trim,s;s=i?i:function(a){return"[object Array]"===l.call(a)};var m;m=n?function(a,b,c){return n.call(a,b,c)}:function(a,b,c){for(var d=0,e=a.length;d<e;++d)b.call(c,a[d],d,a)};var A=/^\s*$/,t;if(p)t=function(a){return null==a?"":p.call(a)};else{var j,w;A.test("\u00a0")?(j=/^\s+/,w=/\s+$/):(j=/^[\s\xA0]+/,w=/[\s\xA0]+$/);t=function(a){return null==a?"":(""+a).replace(j,"").replace(w,"")}}var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},x={}})(Mustache)}
dojo._hasResource["mulberry._View"]||(dojo._hasResource["mulberry._View"]=!0,dojo.provide("mulberry._View"),function(){var a={},b={haml:{firstChars:[".","%"],tmplFn:Haml},mustache:{firstChars:["{","<"],tmplFn:function(a){return dojo.partial(Mustache.render,a)}}};dojo.declare("mulberry._View",[dijit._Widget,dijit._Templated,mulberry._Nls],{templateString:"%div",isHidden:!1,isDisabled:!1,postMixInProperties:function(){this.inherited(arguments);this.device||(this.device=mulberry.Device);this.phone="phone"===
this.device.type;this.tablet="tablet"===this.device.type},_skipNodeCache:!0,_stringRepl:function(c){var d=a[c];d||dojo.forIn(b,function(b,g){d||-1<dojo.indexOf(g.firstChars,c[0])&&(d=a[c]=g.tmplFn(c))});return d(this)},postCreate:function(){this.inherited(arguments)},adopt:function(a,b,e){a=new a(b,e);this._addItem(a);return a},_addItem:function(){this._addedItems=this._addedItems||[];this._addedItems.push.apply(this._addedItems,arguments)},orphan:function(a,b){this._addedItems=this._addedItems||
[];var e=dojo.indexOf(this._addedItems,a);0<=e&&this._addedItems.splice(e,1);b&&this._kill(a)},_kill:function(a){a&&a.destroyRecursive?a.destroyRecursive():a&&a.destroy&&a.destroy()},query:function(a){var b;if(a)a=this.domNode.querySelectorAll(a),b=new dojo.NodeList,dojo.forEach(a,function(a){b.push(a)});else return new dojo.NodeList(this.domNode);return b},preventClickDelay:function(a,b){this.clickables=this.clickables||[];this.clickables.push(new mulberry.ui.Clickable(a,dojo.hitch(this,b)))},destroy:function(){dojo.forEach(this._addedItems,
this._kill);dojo.forEach(this.scrollerHandles||[],function(a){a.destroy()});dojo.forEach(this.clickables||[],function(a){a.destroy()});this.inherited(arguments)},addClass:function(a){dojo.addClass(this.domNode,a)},removeClass:function(a){dojo.removeClass(this.domNode,a)},hasClass:function(a){return dojo.hasClass(this.domNode,a)},show:function(a){a&&a.nodeName?dojo.removeClass(a,"hidden"):(this.removeClass("hidden"),this.isHidden=!1)},hide:function(a){a&&a.nodeName?dojo.addClass(a,"hidden"):(this.addClass("hidden"),
this.isHidden=!0)},toggle:function(a){a?dojo.toggleClass(a,"hidden"):this.isHidden?this.show():this.hide()},enable:function(){this.removeClass("disabled");this.isDisabled=!1},disable:function(){this.addClass("disabled");this.isDisabled=!0}})}());
dojo._hasResource["mulberry.containers.Viewport"]||(dojo._hasResource["mulberry.containers.Viewport"]=!0,dojo.provide("mulberry.containers.Viewport"),dojo.declare("mulberry.containers.Viewport",mulberry._View,{templateString:dojo.cache("mulberry.containers","Viewport/Viewport.haml","%ol.viewport\n"),direction:"next",postCreate:function(){this.connect(this.domNode,"webkitAnimationEnd","_onAnimationEnd")},_setNavDirectionAttr:function(a){this.direction="back"===a?"prev":"next"},_setContentAttr:function(a){if(!mulberry.animating){var b=
this.domNode,c="next"===this.direction;this.direction="next";this.currentPage=a;b.children.length?(mulberry.animating=!0,this.addClass("pre-slide"),a.placeAt(b,c?"last":"first"),this.addClass(c?"slide-left":"slide-right")):(a.placeAt(b,"last"),this._onAnimationEnd());setTimeout(function(){this.animating&&this._onAnimationEnd()},600)}},_cleanupOldPage:function(){var a=document.querySelectorAll("ol.viewport > li");dojo.forEach(a,function(a){this.currentPage.domNode!==a&&(dojo.destroy(a),(a=dijit.byNode(a))&&
a.destroy())},this);this.removeClass(["slide-left","slide-right","pre-slide"])},_onAnimationEnd:function(){this._cleanupOldPage();mulberry.animating=!1;dojo.publish("/page/transition/end")}}));
dojo._hasResource["mulberry.app.UI"]||(dojo._hasResource["mulberry.app.UI"]=!0,dojo.provide("mulberry.app.UI"),dojo.declare("mulberry.app.UI",dojo.Stateful,{containers:{},currentPage:null,constructor:function(a){this.device=a;this.body=dojo.body();this.hasTouch="ontouchstart"in window;this.touchMoveDebounce="android"===a.os?200:0;this._containersSetup();this._watchers();this._updateViewport();this._uiSetup();this._eventSetup()},addPersistentComponent:function(a,b,c){a=new a(b);a.placeAt(this.body,
c);return a},_watchers:function(){dojo.forIn({fontSize:function(a,b,c){a=this.body;b&&dojo.removeClass(a,b);dojo.addClass(a,c);mulberry.app.DeviceStorage.set("fontSize",c);dojo.publish("/fontsize")},navDirection:function(a,b,c){this.containers.viewport.set("navDirection",c)}},this.watch,this)},_updateViewport:function(){this.viewport={width:this.body.offsetWidth,height:this.body.offsetHeight}},_uiSetup:function(){var a=this.body,b=this.device;dojo.addClass(a,b.type);dojo.addClass(a,b.os);dojo.addClass(a,
"version-"+mulberry.app.PhoneGap.device.version);this.set("fontSize",mulberry.app.DeviceStorage.get("fontSize"));mulberry.isMAP&&dojo.addClass(a,"layout-MAP");mulberry.features&&mulberry.features.debugToolbar&&mulberry.app._Debug()},_containersSetup:function(){this.containers.viewport=(new mulberry.containers.Viewport).placeAt(this.body,"first")},_eventSetup:function(){dojo.connect(document,"touchmove",function(a){a.preventDefault()});dojo.connect(window,"resize",this,function(){this._updateViewport();
dojo.publish("/window/resize")});dojo.connect(document,"menubutton",this,function(a){a.preventDefault();dojo.publish("/button/menu")});dojo.connect(document,"backbutton",this,function(a){a.preventDefault();mulberry.app.Router.back()});dojo.connect(document,"searchbutton",this,function(a){mulberry.app.Router.go("/search");a.preventDefault()})},showPage:function(a){if(!a)throw Error("mulberry.app.UI::showPage called without a page to show");if(a.startup)var b=dojo.subscribe("/page/transition/end",function(){a.startup();
dojo.unsubscribe(b)});this.containers.viewport.set("content",a);this.currentPage=a},hideSplash:function(){var a=dojo.byId("splash");a&&dojo.destroy(a)}}),dojo.subscribe("/app/ready",function(){mulberry.app.UI=new mulberry.app.UI(mulberry.Device);dojo.publish("/ui/ready");mulberry.showPage=dojo.hitch(mulberry.app.UI,"showPage")}));
dojo._hasResource["dojo.hash"]||(dojo._hasResource["dojo.hash"]=!0,dojo.provide("dojo.hash"),function(){function a(a,b){var c=a.indexOf(b);return 0<=c?a.substring(c+1):""}function b(){return a(location.href,"#")}function c(){dojo.publish("/dojo/hashchange",[b()])}function d(){b()!==h&&(h=b(),c())}function e(a){if(k)if(k.isTransitioning())setTimeout(dojo.hitch(null,e,a),l);else{var b=k.iframe.location.href,c=b.indexOf("?");k.iframe.location.replace(b.substring(0,c)+"?"+a)}else location.replace("#"+
a),!f&&d()}function g(){function d(){h=b();f=j?h:a(w.href,"?");m=!1;k=null}var e=document.createElement("iframe"),g=dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html");dojo.config.useXDomain&&!dojo.config.dojoBlankHtmlUrl&&console.warn("dojo.hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");e.id="dojo-hash-iframe";e.src=g+"?"+b();e.style.display="none";
document.body.appendChild(e);this.iframe=dojo.global["dojo-hash-iframe"];var f,m,k,t,j,w=this.iframe.location;this.isTransitioning=function(){return m};this.pollLocation=function(){if(!j)try{var o=a(w.href,"?");document.title!=t&&(t=this.iframe.document.title=document.title)}catch(x){j=!0,console.error("dojo.hash: Error adding history entry. Server unreachable.")}var q=b();if(m&&h===q)if(j||o===k)d(),c();else{setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!(h===q&&(j||f===o))){if(h!==
q){h=q;m=!0;k=q;e.src=g+"?"+k;j=!1;setTimeout(dojo.hitch(this,this.pollLocation),0);return}j||(location.href="#"+w.search.substring(1),d(),c())}setTimeout(dojo.hitch(this,this.pollLocation),l)};d();setTimeout(dojo.hitch(this,this.pollLocation),l)}dojo.hash=function(a,c){if(!arguments.length)return b();"#"==a.charAt(0)&&(a=a.substring(1));c?e(a):location.href="#"+a;return a};var h,k,f,l=dojo.config.hashPollFrequency||100;dojo.addOnLoad(function(){"onhashchange"in dojo.global&&(!dojo.isIE||8<=dojo.isIE&&
"BackCompat"!=document.compatMode)?f=dojo.connect(dojo.global,"onhashchange",c):document.addEventListener?(h=b(),setInterval(d,l)):document.attachEvent&&(k=new g)})}());
dojo._hasResource["mulberry.app.Router"]||(dojo._hasResource["mulberry.app.Router"]=!0,dojo.provide("mulberry.app.Router"),function(a){a.declare("mulberry.app.Router",null,{QUERY_STRING_MATCHER:/\?([^#]*)$/,PATH_REPLACER:"([^/]+)",PATH_NAME_MATCHER:/:([\w\d]+)/g,_routes:[],_cache:{},_currentHash:null,_hasHistoryState:!(!history.pushState||!history.replaceState),init:function(){if(!this.defaultRoute)throw console.error("No default route provided to router."),Error("No default route provided to router.");
this.go(window.location.hash.toString().replace("#","")||this.defaultRoute.origRoute,!0);a.subscribe("/dojo/hashchange",this,"_handleHash");this._hasHistoryState&&a.connect(window,"onpopstate",this,function(){this._handleHash(window.location.hash.replace("#",""))})},go:function(a,c,d){a=a.replace("#","");if(this._hasHistoryState)history[c?"replaceState":"pushState"](d,null,"#"+a);else window.location.hash=a;this._handleHash(a)},back:function(){mulberry.app.UI.set("navDirection","back");history.back()},
home:function(){mulberry.app.UI.set("navDirection","back");this.go(this.defaultRoute.origRoute)},_handleHash:function(b){if(b!==this._currentHash){this._currentHash=b;mulberry.logSection("Handling "+b);var c=this.currentRoute=this._lookupRoute(b),d,b=b.replace("#","");c?(d=this._parseParamsFromHash(b),d.pageState=window.history.state,c=a.mixin(c,{hash:b}),c.callback(d,c),a.publish("/router/handleHash/after"),mulberry.endLogSection("Handling "+b)):this.go(this.defaultRoute.origRoute,!0)}},_parseParamsFromHash:function(b){var c=
b.split("?"),b=c[0],c=c[1],d,e=decodeURIComponent,g=this.currentRoute;d=c?a.mixin({},a.queryToObject(c)):{};if(null!==(b=g.path.exec(this._routeablePath(b))))b.shift(),a.forEach(b,function(a,b){g.paramNames[b]?d[g.paramNames[b]]=e(a):(d.splat||(d.splat=[]),d.splat.push(e(a)))});return d},_lookupRoute:function(b){this._cache[b]||a.forEach(this._routes,function(a){this._routeablePath(b).match(a.path)&&(this._cache[b]=a)},this);return this._cache[b]},_routeablePath:function(a){return a.replace(this.QUERY_STRING_MATCHER,
"")},registerRoute:function(b,c,d){var e,g=[],h=b;for(this.PATH_NAME_MATCHER.lastIndex=0;null!==(e=this.PATH_NAME_MATCHER.exec(b));)g.push(e[1]);b=a.isString(b)?RegExp("^"+b.replace(this.PATH_NAME_MATCHER,this.PATH_REPLACER)+"$"):b;b={origRoute:h,path:b,callback:c,paramNames:g};this._routes.push(b);d&&(this.defaultRoute=b);this._cache={}}});mulberry.app.Router=new mulberry.app.Router;mulberry.route=function(a,c,d){mulberry.app.Router.registerRoute(a,c,d)};mulberry.routes=function(a){dojo.forEach(a,
function(a){mulberry.app.Router.registerRoute(a.route,a.handler,a.isDefault)})}}(dojo));
dojo._hasResource["mulberry.ui.BackgroundImage"]||(dojo._hasResource["mulberry.ui.BackgroundImage"]=!0,dojo.provide("mulberry.ui.BackgroundImage"),dojo.declare("mulberry.ui.BackgroundImage",dijit._Widget,{imageUrl:"",isLoaded:!1,loadOnInit:!1,postCreate:function(){this.inherited(arguments);this.loadOnInit&&this.loadImage()},loadImage:function(){this.isLoaded||(dojo.style(this.domNode,{backgroundImage:"url("+this.imageUrl+")",backgroundRepeat:"no-repeat"}),this.isLoaded=!0)},unloadImage:function(){dojo.style(this.domNode,
"backgroundImage",null);this.isLoaded=!1},_setBackgroundImageAttr:function(a){a&&(this.imageUrl=a.url)}}));
dojo._hasResource["mulberry.containers._LayoutBox"]||(dojo._hasResource["mulberry.containers._LayoutBox"]=!0,dojo.provide("mulberry.containers._LayoutBox"),dojo.declare("mulberry.containers._LayoutBox",[mulberry._View,mulberry.ui.BackgroundImage],{templateString:"<div class=layout-box></div>",defaultConfig:{scrollable:!1},postMixInProperties:function(){this.config=dojo.mixin(dojo.mixin({},this.defaultConfig),this.config)},postCreate:function(){this.inherited(arguments);this.config.className&&this.addClass(this.config.className);
this.config.backgroundImage&&this.backgroundImage&&this.loadImage()}}));
dojo._hasResource["mulberry.containers.Region"]||(dojo._hasResource["mulberry.containers.Region"]=!0,dojo.provide("mulberry.containers.Region"),function(){mulberry.components=mulberry.components||{};var a=[mulberry.components];dojo.declare("mulberry.containers.Region",mulberry.containers._LayoutBox,{templateString:dojo.cache("mulberry.containers","Region/Region.haml",".region\n  .pane{ dojoAttachPoint : 'pane' }\n    .inner{ dojoAttachPoint : 'inner' }\n"),config:{},_scroller:null,postCreate:function(){this.inherited(arguments);
this._placeComponents();this._placeRegions();this._setupScroller();this.connect(this.screen,"startup","startup")},_setupScroller:function(){this.config.scrollable&&(this._scroller=new mulberry.ui.Scrollable({},this.pane),this.connect(this._scroller,"onScrollStart","onScrollStart"),this.connect(this._scroller,"onScrollEnd","onScrollEnd"))},_placeComponents:function(){var b=this.config.scrollable?[this.inner,"last"]:[this.pane,"replace"];this.config.components&&1<this.config.components.length&&b[0]===
this.pane&&console.error("WARNING: you're trying to place more than one component into a non-scrollable region. this will end badly.");this.config.components&&this.config.components.length&&dojo.forEach(this.config.components,function(c){var d;c.match(/^custom\./)?d=client.components[c.replace(/^custom\./,"")]:dojo.forEach(a,function(a){d=a[c]});d||console.error("No matching class found for",c);this.adopt(d,{baseObj:this.baseObj,page:this.page,node:this.baseObj,device:this.device,screen:this.screen,
region:this}).placeAt(b[0],b[1])},this)},_placeRegions:function(){var a=this.config.scrollable?[this.inner,"last"]:[this.domNode];this.config.regions&&this.config.regions.length&&(this.config.scrollable||dojo.destroy(this.pane),dojo.forEach(this.config.regions,function(c){this.adopt(mulberry.containers.Region,{config:c,baseObj:this.baseObj,device:this.device,screen:this.screen,backgroundImage:this.backgroundImage}).placeAt(a[0],a[1])},this))},refreshScroller:function(){this._scroller&&this._scroller.refreshScroller()},
onScrollStart:function(){},onScrollEnd:function(){}});mulberry.registerComponentNamespace=function(b){a.push(b)}}());
dojo._hasResource["mulberry.containers.Screen"]||(dojo._hasResource["mulberry.containers.Screen"]=!0,dojo.provide("mulberry.containers.Screen"),dojo.declare("mulberry.containers.Screen",mulberry.containers._LayoutBox,{templateString:dojo.cache("mulberry.containers","Screen/Screen.haml",".screen\n"),components:{},postCreate:function(){this.inherited(arguments);this.addClass(this.config.name);this.config.regions&&(this.regions=dojo.map(this.config.regions,function(a){return this.adopt(mulberry.containers.Region,
{page:this.page,config:a,baseObj:this.baseObj,device:this.device,screen:this,backgroundImage:this.backgroundImage}).placeAt(this.domNode)},this))},registerComponent:function(a){var b=a.declaredClass.split(".");this.components[b[b.length-1]]=a},getComponent:function(a){a=a.replace("custom.","");return this.components[a]}}));
dojo._hasResource["mulberry.containers.Page"]||(dojo._hasResource["mulberry.containers.Page"]=!0,dojo.provide("mulberry.containers.Page"),function(){mulberry.capabilities=mulberry.capabilities||{};var a=[mulberry.capabilities];dojo.declare("mulberry.containers.Page",[mulberry._View,mulberry.ui.BackgroundImage],{pageDef:{},templateString:dojo.cache("mulberry.containers","Page/Page.haml","%li.page\n"),postMixInProperties:function(){this.inherited(arguments);this.baseObj.shareable="node"===this.baseObj.type},
postCreate:function(){this.screens={};if(!this.baseObj)throw"mulberry.Page requires a base object";if(!this.pageDef.screens||!this.pageDef.screens.length)throw"The config for mulberry.Page must have at least one screen defined";var b=this.baseObj.pageBackground;dojo.forEach(this.pageDef.screens,function(a){var d=this.adopt(mulberry.containers.Screen,{page:this,config:a,baseObj:this.baseObj,device:this.device,backgroundImage:b}).placeAt(this.domNode);this.screens[a.name]=d},this);this.capabilities=
dojo.map(this.pageDef.capabilities||[],function(b){var d=dojo.isObject(b)?b.name:b,b=b.components,e;dojo.forEach(a,function(a){e=a[d]||e});return!e?(console.warn("No capability",d,"defined in these namespaces:"),dojo.forEach(a,function(a){console.log("-- namespace",a)},this),null):new e({page:this,baseObj:this.baseObj,components:b})},this);this.screens.detail&&this.screens.detail.hide();this.baseObj.id&&this.addClass("page-"+this.baseObj.id);this.pageDefName&&this.addClass(this.pageDefName)},showScreen:function(a){dojo.forIn(this.screens,
function(c,d){c!==a&&d.hide()});this.screens[a].show()},getScreen:function(a){return this.screens[a]},getComponent:function(a){var c=!1;this._components=this._components||{};this._components[a]||(dojo.forIn(this.screens,function(d,e){var g=e.getComponent(a);g&&(c=g)}),this._components[a]=c);return this._components[a]},startup:function(){this.inherited(arguments);dojo.forIn(this.screens,function(a,c){c.startup()})},init:function(){}});mulberry.registerCapabilityNamespace=function(b){a.push(b)}}());
dojo._hasResource["mulberry.app.PageFactory"]||(dojo._hasResource["mulberry.app.PageFactory"]=!0,dojo.provide("mulberry.app.PageFactory"),dojo.declare("mulberry.app.PageFactory",null,{constructor:function(a){this.device=a},createPage:function(a){if(!a)throw Error("mulberry.app.PageFactory::createPage requires an object");var b=a.pageDef||"default",c=mulberry.pageDefs[b];if(!c)throw'mulberry.app.PageFactory: The page definition "'+b+'" does not exist.';mulberry.log("Creating "+b);return new mulberry.containers.Page({baseObj:a,
device:this.device,pageDef:c,pageDefName:b})}}),dojo.subscribe("/app/ready",function(){mulberry.app.PageFactory=new mulberry.app.PageFactory(mulberry.Device);mulberry.createPage=dojo.hitch(mulberry.app.PageFactory,"createPage")}));
dojo._hasResource["mulberry.app.Notifications"]||(dojo._hasResource["mulberry.app.Notifications"]=!0,dojo.provide("mulberry.app.Notifications"),function(){var a;mulberry.app.Notifications={areAvailable:function(){return!!mulberry.app.PhoneGap.present},init:function(){mulberry.app.PhoneGap.present&&(window.plugins.pushNotification.startNotify(),this._apnRegister())},setNotificationCallback:function(b){mulberry.app.PhoneGap.present&&(a=window.plugins.pushNotification.notificationCallback=b)},notify:function(b){a(b)},
_apnRegister:function(){window.plugins.pushNotification.register(function(a){mulberry.app.Notifications._apnOnRegisterSuccess(a)},function(a){mulberry.app.Notifications._apnOnRegisterError(a)},[{alert:!0,badge:!0,sound:!0}]);console.log("APN push notification registered.")},_apnOnRegisterSuccess:function(a){this._urbanAirshipRegister(a.deviceToken,a.host,a.appKey,a.appSecret)},_apnOnRegisterError:function(a){console.log("error registering with APN: "+a.toString())},_urbanAirshipRegister:function(a,
b,e,g){var h=new XMLHttpRequest;h.open("PUT",b+"api/device_tokens/"+a,!0,e,g);h.onload=function(){200===this.status||201===this.status?console.log("Successfully registered with Urban Airship."):console.log("Error when registring with Urban Airship: "+this.statusText)};h.send()}};var b=mulberry.app.Notifications;dojo.subscribe("/app/ready",function(){var a=function(){},d="Notification from "+mulberry.app.Config.get("app").name;b.init();b.setNotificationCallback(function(b){window.navigator.notification.alert(b.alert,
a,d)})})}());dojo._hasResource["mulberry.app.Has"]||(dojo._hasResource["mulberry.app.Has"]=!0,dojo.provide("mulberry.app.Has"),mulberry.app.Has=function(){var a=mulberry.Device;return{html5Player:function(){return"android"!==a.os},iScrollZoom:function(){return"android"!==a.os}}},function(){var a=dojo.subscribe("/app/deviceready",function(){dojo.unsubscribe(a);dojo.isFunction(mulberry.app.Has)&&(mulberry.app.Has=mulberry.app.Has())})}());
dojo._hasResource["dojo.regexp"]||(dojo._hasResource["dojo.regexp"]=!0,dojo.provide("dojo.regexp"),dojo.getObject("regexp",!0,dojo),dojo.regexp.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(a){return b&&-1!=b.indexOf(a)?a:"\\"+a})},dojo.regexp.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var d=[],e=0;e<a.length;e++)d.push(b(a[e]));return dojo.regexp.group(d.join("|"),c)},dojo.regexp.group=function(a,b){return"("+(b?"?:":"")+a+")"});
dojo._hasResource["dojo.cookie"]||(dojo._hasResource["dojo.cookie"]=!0,dojo.provide("dojo.cookie"),dojo.cookie=function(a,b,c){var d=document.cookie;if(1==arguments.length){var e=d.match(RegExp("(?:^|; )"+dojo.regexp.escapeString(a)+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}c=c||{};d=c.expires;if("number"==typeof d){var g=new Date;g.setTime(g.getTime()+864E5*d);d=c.expires=g}d&&d.toUTCString&&(c.expires=d.toUTCString());b=encodeURIComponent(b);d=a+"="+b;for(e in c)d+="; "+e,g=c[e],!0!==
g&&(d+="="+g);document.cookie=d},dojo.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled});
dojo._hasResource["mulberry._Component"]||(dojo._hasResource["mulberry._Component"]=!0,dojo.provide("mulberry._Component"),dojo.declare("mulberry._Component",mulberry._View,{handleClicks:!1,prepareData:function(){},setupConnections:function(){},setupSubscriptions:function(){},setupChildComponents:function(){},adjustMarkup:function(){},resizeElements:function(){},teardown:function(){},populate:function(a,b){this.populateElement(this.domNode,a,b)},populateElement:function(a,b,c){dojo.isString(a)&&(a=
this[a]);a&&(a.innerHTML=dojo.isArray(c)?dojo.map(c,b).join(""):b(c),this.region&&this.region.refreshScroller())},postMixInProperties:function(){this.inherited(arguments);this.screen&&(this.screen.registerComponent(this),this.connect(this.screen,"startup","startup"));this.prepareData();this._loadHelpers();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.isHidden&&this.hide();this.handleClicks&&this.preventClickDelay(this.clickableNode||this.domNode,this._clickHandler&&
dojo.hitch(this,"_clickHandler"));this.subscribe("/window/resize",function(){this.dimensions=null});this.setupChildComponents();this.adjustMarkup();this.setupConnections();this.setupSubscriptions()},startup:function(){this.inherited(arguments);this.resizeElements();this.when&&dojo.forIn(this.when,function(a,b){(this.node||this.baseObj)[a].then(dojo.hitch(this,b))},this)},destroy:function(){this.teardown();this.inherited(arguments)},_loadHelpers:function(){this.helpers&&dojo.isObject(this.helpers)&&
dojo.forIn(this.helpers,function(a,b){b&&(this.helpers[a]=Haml(b)())},this)},_setupTouch:function(a,b){var c=mulberry.app.UI.hasTouch;this.connect(a,c?"touchstart":"click",b);c&&this.connect(a,"click",function(a){a.preventDefault()})},getDimensions:function(){return this.dimensions=this.dimensions||{width:dojo.style(this.domNode,"width"),height:dojo.style(this.domNode,"height")}}}),mulberry.component=function(a,b){var c=dojo.mixin(b,{templateString:b.componentTemplate||"%div",prepareData:function(){this.inherited(arguments);
b.prep&&b.prep.call(this)},postCreate:function(){this.inherited(arguments);window.jQuery&&(this.$domNode=jQuery(this.domNode))},startup:function(){this.inherited(arguments);b.init&&b.init.call(this)}});dojo.declare("client.components."+a,mulberry._Component,c)});
dojo._hasResource["mulberry.app._Debug"]||(dojo._hasResource["mulberry.app._Debug"]=!0,dojo.provide("mulberry.app._Debug"),function(){dojo.subscribe("/debug/user",function(a){confirm("Click OK if you want to enter debug mode.")&&mulberry.app.Router.go("/debug/"+a)});mulberry.app._Debug=function(){var a=(new mulberry.app._Debug.Tools).placeAt(dojo.body(),"first"),b=(new mulberry.app._Debug.Message).placeAt(dojo.body(),"first");dojo.connect(a,"onWeinre",function(a){b.set("content",["Debug &#64; http://api.toura.com/weinre/ code: "].join(a.slice(1)))})};
mulberry.app._Debug.weinre={init:function(){var a;if(!(a=dojo.cookie("debug-hash"))){a=[];for(var b=2;b--;)a.push((65536*(1+Math.random())).toString(16).substring(0,3));a="#m-"+a.join("")}b=document.createElement("script");b.src=this.script+a;if(this.enabled)return a;window.WeinreServerURL="http://api.toura.com/weinre/";document.body.appendChild(b);dojo.cookie("debug-hash",a);this.enabled=!0;return a},script:"http://api.toura.com/weinre/target/target-script-min.js",client:function(a){return"http://api.toura.com/weinre/"+
"client/{hash}".replace("{hash}",a)}};dojo.declare("mulberry.app._Debug.Tools",mulberry._Component,{templateString:'<div class="component debug-tools"><div class="buttons"></div></div>',actions:[{name:"Reset DB",method:"_resetDB"},{name:"weinre",method:"_weinre"}],postCreate:function(){this.inherited(arguments);this._makeActions()},_makeActions:function(){dojo.forEach(this.actions,function(a){var b=dojo.create("div",{className:"button",innerHTML:a.name});dojo.place(b,this.domNode.firstChild);this.connect(b,
"click",a.method)},this)},_resetDB:function(){mulberry.app.DeviceStorage.drop();window.location.reload()},_weinre:function(){if(!this.hasWeinre){var a=mulberry.app._Debug.weinre.init();this.hasWeinre=!0;this.onWeinre(a)}},onWeinre:function(){}});dojo.declare("mulberry.app._Debug.Message",mulberry._Component,{templateString:'<div class="component debug-message"></div>',postCreate:function(){this.inherited(arguments);var a=dojo.create("div",{className:"close",innerHTML:"close"});dojo.place(a,this.domNode);
this.connect(a,"click",function(){this.hide()});this.msgNode=dojo.create("div");dojo.place(this.msgNode,this.domNode);this.hide()},_setContentAttr:function(a){this.show();this.msgNode.innerHTML=a}})}());
dojo._hasResource["mulberry.components.Debug"]||(dojo._hasResource["mulberry.components.Debug"]=!0,dojo.provide("mulberry.components.Debug"),function(){var a={};dojo.declare("mulberry.components.Debug",mulberry._Component,{templateString:dojo.cache("mulberry.components","Debug/Debug.haml",".component.debug\n  .status{ dojoAttachPoint : 'status' }\n\n  %table{ dojoAttachPoint : 'deviceInfo' }\n\n  %ul.actions\n    %li{ dojoAttachEvent : 'click:_weinre' } weinre\n    %li{ dojoAttachEvent : 'click:_resetDB' } reset\n\n"),prepareData:function(){var b=
[],c=function(a,b){return"<tr><th>{k}</th><td>{v}</td></tr>".replace("{k}",a).replace("{v}",b)},d=function(a){return"<tr><th colspan=2>"+a+"</th></tr>"};b.push(d("Device"));window.device&&dojo.forIn(window.device,function(a,d){b.push(c(a,d))});b.push(c("UA",window.navigator.userAgent));b.push(c("Device Type",this.device.type));b.push(c("Device OS",this.device.os));var e=mulberry.app.Config.get("app");b.push(d("App"));b.push(c("Build Date",mulberry.app.Config.get("buildDate")));b.push(c("Data Version",
mulberry.app.Tour._getLocalVersion()));dojo.forIn(e,function(a,d){b.push(c(a,d))});b.push(d("Features"));dojo.forIn(a,function(a,d){b.push(c(a,d?"true":"false"))});this.info=b.join("");this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.deviceInfo.innerHTML=this.info},_weinre:function(){this.status.innerHTML="debugging at "+mulberry.app._Debug.weinre.init();dojo.publish("/content/update")},_resetDB:function(){mulberry.app.DeviceStorage.drop();window.location.reload()}});
mulberry.components.Debug.registerFeaturesObject=function(b){dojo.mixin(a,b)}}());
dojo._hasResource["dojo.date"]||(dojo._hasResource["dojo.date"]=!0,dojo.provide("dojo.date"),dojo.getObject("date",!0,dojo),dojo.date.getDaysInMonth=function(a){var b=a.getMonth(),c=[31,28,31,30,31,30,31,31,30,31,30,31];return 1==b&&dojo.date.isLeapYear(a)?29:c[b]},dojo.date.isLeapYear=function(a){a=a.getFullYear();return!(a%400)||!(a%4)&&!!(a%100)},dojo.date.getTimezoneName=function(a){var b=a.toString(),c="",d=b.indexOf("(");if(-1<d)c=b.substring(++d,b.indexOf(")"));else if(d=/([A-Z\/]+) \d{4}$/,
b=b.match(d))c=b[1];else if(b=a.toLocaleString(),d=/ ([A-Z\/]+)$/,b=b.match(d))c=b[1];return"AM"==c||"PM"==c?"":c},dojo.date.compare=function(a,b,c){a=new Date(+a);b=new Date(+(b||new Date));"date"==c?(a.setHours(0,0,0,0),b.setHours(0,0,0,0)):"time"==c&&(a.setFullYear(0,0,0),b.setFullYear(0,0,0));return a>b?1:a<b?-1:0},dojo.date.add=function(a,b,c){var d=new Date(+a),e=!1,g="Date";switch(b){case "day":break;case "weekday":var h;(b=c%5)?h=parseInt(c/5):(b=0<c?5:-5,h=0<c?(c-5)/5:(c+5)/5);var k=a.getDay(),
f=0;6==k&&0<c?f=1:0==k&&0>c&&(f=-1);k+=b;if(0==k||6==k)f=0<c?2:-2;c=7*h+b+f;break;case "year":g="FullYear";e=!0;break;case "week":c*=7;break;case "quarter":c*=3;case "month":e=!0;g="Month";break;default:g="UTC"+b.charAt(0).toUpperCase()+b.substring(1)+"s"}if(g)d["set"+g](d["get"+g]()+c);e&&d.getDate()<a.getDate()&&d.setDate(0);return d},dojo.date.difference=function(a,b,c){var b=b||new Date,c=c||"day",d=b.getFullYear()-a.getFullYear(),e=1;switch(c){case "quarter":a=a.getMonth();b=b.getMonth();a=Math.floor(a/
3)+1;b=Math.floor(b/3)+1;e=b+4*d-a;break;case "weekday":d=Math.round(dojo.date.difference(a,b,"day"));c=parseInt(dojo.date.difference(a,b,"week"));if(0==d%7)d=5*c;else{var e=0,g=a.getDay(),h=b.getDay(),c=parseInt(d/7),b=d%7,a=new Date(a);a.setDate(a.getDate()+7*c);a=a.getDay();if(0<d)switch(!0){case 6==g:e=-1;break;case 0==g:e=0;break;case 6==h:e=-1;break;case 0==h:e=-2;break;case 5<a+b:e=-2}else if(0>d)switch(!0){case 6==g:e=0;break;case 0==g:e=1;break;case 6==h:e=2;break;case 0==h:e=1;break;case 0>
a+b:e=2}d=d+e-2*c}e=d;break;case "year":e=d;break;case "month":e=b.getMonth()-a.getMonth()+12*d;break;case "week":e=parseInt(dojo.date.difference(a,b,"day")/7);break;case "day":e/=24;case "hour":e/=60;case "minute":e/=60;case "second":e/=1E3;case "millisecond":e*=b.getTime()-a.getTime()}return Math.round(e)});
dojo._hasResource["dojo.cldr.supplemental"]||(dojo._hasResource["dojo.cldr.supplemental"]=!0,dojo.provide("dojo.cldr.supplemental"),dojo.getObject("cldr.supplemental",!0,dojo),dojo.cldr.supplemental.getFirstDayOfWeek=function(a){a={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,sy:6,tn:6,ye:6,ar:0,as:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,il:0,"in":0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mn:0,mo:0,mp:0,mt:0,nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,
um:0,us:0,uz:0,vi:0,zw:0}[dojo.cldr.supplemental._region(a)];return void 0===a?1:a},dojo.cldr.supplemental._region=function(a){var a=dojo.i18n.normalizeLocale(a),a=a.split("-"),b=a[1];b?4==b.length&&(b=a[2]):b={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[a[0]];return b},dojo.cldr.supplemental.getWeekend=function(a){var b=dojo.cldr.supplemental._region(a),a={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,
ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[b],b={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[b];void 0===a&&(a=6);void 0===b&&(b=0);return{start:a,end:b}});
dojo._hasResource["dojo.date.locale"]||(dojo._hasResource["dojo.date.locale"]=!0,dojo.provide("dojo.date.locale"),dojo.getObject("date.locale",!0,dojo),function(){function a(a,b,c,h){return h.replace(/([a-z])\1*/ig,function(k){var f,l,i=k.charAt(0),k=k.length,n=["abbr","wide","narrow"];switch(i){case "G":f=b[4>k?"eraAbbr":"eraNames"][0>a.getFullYear()?0:1];break;case "y":f=a.getFullYear();switch(k){case 1:break;case 2:if(!c.fullYear){f=""+f;f=f.substr(f.length-2);break}default:l=!0}break;case "Q":case "q":f=
Math.ceil((a.getMonth()+1)/3);l=!0;break;case "M":f=a.getMonth();3>k?(f+=1,l=!0):(i=["months-format",n[k-3]].join("-"),f=b[i][f]);break;case "w":f=dojo.date.locale._getWeekOfYear(a,0);l=!0;break;case "d":f=a.getDate();l=!0;break;case "D":f=dojo.date.locale._getDayOfYear(a);l=!0;break;case "E":f=a.getDay();3>k?(f+=1,l=!0):(i=["days-format",n[k-3]].join("-"),f=b[i][f]);break;case "a":f=12>a.getHours()?"am":"pm";f=c[f]||b["dayPeriods-format-wide-"+f];break;case "h":case "H":case "K":case "k":l=a.getHours();
switch(i){case "h":f=l%12||12;break;case "H":f=l;break;case "K":f=l%12;break;case "k":f=l||24}l=!0;break;case "m":f=a.getMinutes();l=!0;break;case "s":f=a.getSeconds();l=!0;break;case "S":f=Math.round(a.getMilliseconds()*Math.pow(10,k-3));l=!0;break;case "v":case "z":if(f=dojo.date.locale._getZone(a,!0,c))break;k=4;case "Z":f=dojo.date.locale._getZone(a,!1,c);f=[0>=f?"+":"-",dojo.string.pad(Math.floor(Math.abs(f)/60),2),dojo.string.pad(Math.abs(f)%60,2)];4==k&&(f.splice(0,0,"GMT"),f.splice(3,0,":"));
f=f.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+h);}l&&(f=dojo.string.pad(f,k));return f})}function b(a,b,c,h){var k=function(a){return a},b=b||k,c=c||k,h=h||k,f=a.match(/(''|[^'])+/g),l="'"==a.charAt(0);dojo.forEach(f,function(a,d){a?(f[d]=(l?c:b)(a.replace(/''/g,"'")),l=!l):f[d]=""});return h(f.join(""))}function c(a,b,c,h){h=dojo.regexp.escapeString(h);c.strict||(h=h.replace(" a"," ?a"));return h.replace(/([a-z])\1*/ig,function(h){var f;f=h.charAt(0);var l=
h.length,i="",n="";c.strict?(1<l&&(i="0{"+(l-1)+"}"),2<l&&(n="0{"+(l-2)+"}")):(i="0?",n="0{0,2}");switch(f){case "y":f="\\d{2,4}";break;case "M":f=2<l?"\\S+?":i+"[1-9]|1[0-2]";break;case "D":f=i+"[1-9]|"+n+"[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6]";break;case "d":f="3[01]|[12]\\d|"+i+"[1-9]";break;case "w":f=i+"[1-9]|[1-4][0-9]|5[0-3]";break;case "E":f="\\S+";break;case "h":f=i+"[1-9]|1[0-2]";break;case "k":f=i+"\\d|1[01]";break;case "H":f=i+"\\d|1\\d|2[0-3]";break;case "K":f=i+"[1-9]|1\\d|2[0-4]";
break;case "m":case "s":f="[0-5]\\d";break;case "S":f="\\d{"+l+"}";break;case "a":l=c.am||b["dayPeriods-format-wide-am"];i=c.pm||b["dayPeriods-format-wide-pm"];c.strict?f=l+"|"+i:(f=l+"|"+i,l!=l.toLowerCase()&&(f+="|"+l.toLowerCase()),i!=i.toLowerCase()&&(f+="|"+i.toLowerCase()),-1!=f.indexOf(".")&&(f+="|"+f.replace(/\./g,"")));f=f.replace(/\./g,"\\.");break;default:f=".*"}a&&a.push(h);return"("+f+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}dojo.date.locale._getZone=function(a,b){return b?dojo.date.getTimezoneName(a):
a.getTimezoneOffset()};dojo.date.locale.format=function(c,e){var e=e||{},g=dojo.i18n.normalizeLocale(e.locale),h=e.formatLength||"short",g=dojo.date.locale._getGregorianBundle(g),k=[],f=dojo.hitch(this,a,c,g,e);if("year"==e.selector)return b(g["dateFormatItem-yyyy"]||"yyyy",f);var l;"date"!=e.selector&&(l=e.timePattern||g["timeFormat-"+h])&&k.push(b(l,f));"time"!=e.selector&&(l=e.datePattern||g["dateFormat-"+h])&&k.push(b(l,f));return 1==k.length?k[0]:g["dateTimeFormat-"+h].replace(/\{(\d+)\}/g,function(a,
b){return k[b]})};dojo.date.locale.regexp=function(a){return dojo.date.locale._parseInfo(a).regexp};dojo.date.locale._parseInfo=function(a){var a=a||{},e=dojo.i18n.normalizeLocale(a.locale),e=dojo.date.locale._getGregorianBundle(e),g=a.formatLength||"short",h=a.datePattern||e["dateFormat-"+g],k=a.timePattern||e["timeFormat-"+g],g="date"==a.selector?h:"time"==a.selector?k:e["dateTimeFormat-"+g].replace(/\{(\d+)\}/g,function(a,b){return[k,h][b]}),f=[];return{regexp:b(g,dojo.hitch(this,c,f,e,a)),tokens:f,
bundle:e}};dojo.date.locale.parse=function(a,b){var c=/[\u200E\u200F\u202A\u202E]/g,h=dojo.date.locale._parseInfo(b),k=h.tokens,f=h.bundle,c=RegExp("^"+h.regexp.replace(c,"")+"$",h.strict?"":"i").exec(a&&a.replace(c,""));if(!c)return null;var l=["abbr","wide","narrow"],i=[1970,0,1,0,0,0,0],n="",c=dojo.every(c,function(a,c){if(!c)return!0;var d=k[c-1],g=d.length;switch(d.charAt(0)){case "y":if(2!=g&&b.strict)i[0]=a;else if(100>a)a=Number(a),g=""+(new Date).getFullYear(),d=100*g.substring(0,2),g=Math.min(Number(g.substring(2,
4))+20,99),i[0]=a<g?d+a:d-100+a;else{if(b.strict)return!1;i[0]=a}break;case "M":if(2<g){if(d=f["months-format-"+l[g-3]].concat(),b.strict||(a=a.replace(".","").toLowerCase(),d=dojo.map(d,function(a){return a.replace(".","").toLowerCase()})),a=dojo.indexOf(d,a),-1==a)return!1}else a--;i[1]=a;break;case "E":case "e":d=f["days-format-"+l[g-3]].concat();b.strict||(a=a.toLowerCase(),d=dojo.map(d,function(a){return a.toLowerCase()}));a=dojo.indexOf(d,a);if(-1==a)return!1;break;case "D":i[1]=0;case "d":i[2]=
a;break;case "a":d=b.am||f["dayPeriods-format-wide-am"];g=b.pm||f["dayPeriods-format-wide-pm"];if(!b.strict)var h=/\./g,a=a.replace(h,"").toLowerCase(),d=d.replace(h,"").toLowerCase(),g=g.replace(h,"").toLowerCase();if(b.strict&&a!=d&&a!=g)return!1;n=a==g?"p":a==d?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":if(23<a)return!1;i[3]=a;break;case "m":i[4]=a;break;case "s":i[5]=a;break;case "S":i[6]=a}return!0}),h=+i[3];"p"===n&&12>h?i[3]=h+12:"a"===n&&12==h&&(i[3]=0);h=new Date(i[0],
i[1],i[2],i[3],i[4],i[5],i[6]);b.strict&&h.setFullYear(i[0]);var p=k.join(""),s=-1!=p.indexOf("d"),p=-1!=p.indexOf("M");if(!c||p&&h.getMonth()>i[1]||s&&h.getDate()>i[2])return null;if(p&&h.getMonth()<i[1]||s&&h.getDate()<i[2])h=dojo.date.add(h,"hour",1);return h}}(),function(){var a=[];dojo.date.locale.addCustomFormats=function(b,c){a.push({pkg:b,name:c})};dojo.date.locale._getGregorianBundle=function(b){var c={};dojo.forEach(a,function(a){a=dojo.i18n.getLocalization(a.pkg,a.name,b);c=dojo.mixin(c,
a)},this);return c}}(),dojo.date.locale.addCustomFormats("dojo.cldr","gregorian"),dojo.date.locale.getNames=function(a,b,c,d){var e,d=dojo.date.locale._getGregorianBundle(d),a=[a,c,b];"standAlone"==c&&(c=a.join("-"),e=d[c],1==e[0]&&(e=void 0));a[1]="format";return(e||d[a.join("-")]).concat()},dojo.date.locale.isWeekend=function(a,b){var c=dojo.cldr.supplemental.getWeekend(b),d=(a||new Date).getDay();c.end<c.start&&(c.end+=7,d<c.start&&(d+=7));return d>=c.start&&d<=c.end},dojo.date.locale._getDayOfYear=
function(a){return dojo.date.difference(new Date(a.getFullYear(),0,1,a.getHours()),a)+1},dojo.date.locale._getWeekOfYear=function(a,b){1==arguments.length&&(b=0);var c=(new Date(a.getFullYear(),0,1)).getDay(),d=Math.floor((dojo.date.locale._getDayOfYear(a)+(c-b+7)%7-1)/7);c==b&&d++;return d});dojo._hasResource["mulberry.app._base"]||(dojo._hasResource["mulberry.app._base"]=!0,dojo.provide("mulberry.app._base"));
if(!dojo._hasResource["mulberry.base"]){dojo._hasResource["mulberry.base"]=!0;dojo.provide("mulberry.base");$m=mulberry;mulberry.version="0.3";var readyFn=function(){mulberry.app.DeviceStorage.init(mulberry.app.Config.get("id")||"mulberry");dojo.publish("/app/deviceready");dojo.subscribe("/app/ready",function(){mulberry.app.Router.init();mulberry.app.UI.hideSplash()})};document.addEventListener("deviceready",function(){dojo.ready(readyFn)},!1)}
dojo.i18n._preloadLocalizations("mulberry.nls.base",["ROOT","en","en-us","xx"]);
